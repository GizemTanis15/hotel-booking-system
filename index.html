<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Swiss - Rezervasyon Sistemi</title>
    <style>
          #chatbotContainer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        max-height: 500px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        z-index: 9999;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #chatbotHeader {
        background: linear-gradient(135deg, #667eea, #764ba2);
        padding: 10px;
        color: white;
        font-weight: bold;
        text-align: center;
    }
    #chatMessages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        font-size: 14px;
    }
    #chatInputArea {
        display: flex;
        border-top: 1px solid #ddd;
    }
    #chatInput {
        flex: 1;
        padding: 10px;
        border: none;
        outline: none;
        font-size: 14px;
    }
    #chatSendBtn {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        transition: 0.3s ease;
    }
    #chatSendBtn:hover {
        background: #5a67d8;
    }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 15px;
            padding: 10px 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 25px;
        }

        .user-info.show {
            display: flex;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .auth-buttons button, .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .login-btn, .admin-login-btn {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea !important;
        }

        .register-btn, .logout-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .logout-btn {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .btn:hover, .auth-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .main-content {
            display: grid;
            gap: 30px;
            grid-template-columns: 1fr 1fr;
        }

        .admin-panel, .search-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .panel-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #333;
            text-align: center;
            position: relative;
        }

        .panel-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .search-results {
            margin-top: 30px;
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .hotel-card {
            display: flex;
            gap: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .hotel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .hotel-image {
            width: 200px;
            height: 150px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .hotel-info {
            flex: 1;
        }

        .hotel-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .hotel-location {
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .hotel-features {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .feature-tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .hotel-price {
            text-align: right;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .price {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .price-note {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .error-message {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .success-message {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.3s ease-out;
            max-width: 400px;
        }

        .notification.success {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
        }

        .notification.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .notification.info {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .room-management {
            display: none;
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .room-list {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .room-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .room-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .room-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
            margin: 0;
        }

        .btn-edit {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .btn-delete {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .my-bookings {
            display: none;
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .booking-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-btn {
            padding: 10px 20px;
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
            font-weight: 600;
        }

        .admin-tab-content {
            width: 100%;
        }

        .admin-tabs .tab-btn {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #667eea;
            font-weight: 600;
            font-size: 14px;
        }

        .admin-tabs .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .admin-tabs .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .form-row .form-group {
                margin-bottom: 20px;
            }
            
            .hotel-card {
                flex-direction: column;
            }
            
            .hotel-image {
                width: 100%;
                height: 200px;
            }
            
            .auth-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .nav {
                flex-direction: column;
                gap: 15px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div id="chatbotContainer">
        <div id="chatbotHeader">💬 Hotel Swiss Bot</div>
        <div id="chatMessages"></div>
        <div id="chatInputArea">
            <input id="chatInput" type="text" placeholder="Mesajınızı yazın...">
            <button id="chatSendBtn">Gönder</button>
        </div>
    </div>
    
    <div class="container">
        <header class="header">
            <nav class="nav">
                <div class="logo">🏨 Hotel Swiss</div>
                
                <!-- User Info (shown when logged in) -->
                <div class="user-info" id="userInfo">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <div id="userName">Kullanıcı</div>
                        <div style="font-size: 12px; color: #666;" id="userRole">user</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Çıkış</button>
                </div>

                <!-- Auth buttons (shown when not logged in) -->
                <div class="auth-buttons" id="authButtons">
                    <button class="login-btn" onclick="openModal('loginModal')">Giriş Yap</button>
                    <button class="register-btn" onclick="openModal('registerModal')">Kayıt Ol</button>
                    <button class="admin-login-btn" onclick="openModal('adminLoginModal')">Admin Girişi</button>
                </div>
            </nav>

            <!-- Tab Navigation -->
            <div class="tab-buttons" id="tabButtons" style="display: none;">
                <div class="tab-btn active" onclick="showTab('search')">🔍 Arama</div>
                <div class="tab-btn" onclick="showTab('bookings')" id="bookingsTab" style="display: none;">📋 Rezervasyonlarım</div>
                <div class="tab-btn" onclick="showTab('rooms')" id="roomsTab" style="display: none;">🏨 Oda Yönetimi</div>
            </div>
        </header>

        <div class="main-content">
            <!-- Hotel Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <h2 class="panel-title">🔐 Oda Yönetimi</h2>
                
                <!-- Tab buttons for admin panel -->
                <div class="admin-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                    <button type="button" class="tab-btn active" onclick="showAdminTab('room-form')">➕ Oda Ekle/Düzenle</button>
                    <button type="button" class="tab-btn" onclick="showAdminTab('availability')">📅 Müsaitlik Yönet</button>
                </div>

                <!-- Room Form Tab -->
                <div id="room-form-tab" class="admin-tab-content">
                    <form id="roomForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="roomNumber">Oda Numarası</label>
                                <input type="text" id="roomNumber" name="roomNumber" required>
                            </div>
                            <div class="form-group">
                                <label for="roomType">Oda Tipi</label>
                                <select id="roomType" name="roomType" required>
                                    <option value="">Seçiniz</option>
                                    <option value="Single">Tek Kişilik</option>
                                    <option value="Double">Çift Kişilik</option>
                                    <option value="Suite">Suite</option>
                                    <option value="Family">Aile Odası</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="price">Fiyat (₺)</label>
                                <input type="number" id="price" name="price" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="capacity">Kapasite</label>
                                <input type="number" id="capacity" name="capacity" min="1" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="destination">Konum</label>
                            <input type="text" id="destination" name="destination" placeholder="İstanbul, Ankara, İzmir..." required>
                        </div>

                        <div class="form-group">
                            <label for="description">Açıklama</label>
                            <textarea id="description" name="description" rows="3" placeholder="Oda hakkında detaylı açıklama..."></textarea>
                        </div>

                        <button type="submit" class="btn" id="roomSubmitBtn">
                            <span id="roomBtnText">ODA EKLE</span>
                            <span id="roomLoader" class="loading" style="display: none;"></span>
                        </button>
                    </form>
                </div>

                <!-- Availability Management Tab -->
                <div id="availability-tab" class="admin-tab-content" style="display: none;">
                    <form id="availabilityForm">
                        <div class="form-group">
                            <label for="availabilityRoom">Oda Seçin</label>
                            <select id="availabilityRoom" required>
                                <option value="">Oda seçiniz...</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="availabilityStartDate">Başlangıç Tarihi</label>
                                <input type="date" id="availabilityStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="availabilityEndDate">Bitiş Tarihi</label>
                                <input type="date" id="availabilityEndDate" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="availabilityTotalRooms">Toplam Oda Sayısı</label>
                            <input type="number" id="availabilityTotalRooms" min="1" value="4" required>
                            <small style="color: #666; font-size: 12px;">Bu tarih aralığında müsait oda sayısı</small>
                        </div>

                        <button type="submit" class="btn">
                            <span id="availabilityBtnText">📅 MÜSAİTLİK GÜNCELLE</span>
                            <span id="availabilityLoader" class="loading" style="display: none;"></span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Hotel Search Panel -->
            <div class="search-panel" id="searchPanel">
                <h2 class="panel-title">🔍 Hotel Arama</h2>
                <form id="searchForm">
                    <div class="form-group">
                        <label for="location">Konum</label>
                        <input type="text" id="location" name="location" placeholder="Şehir veya bölge">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="checkin">Giriş Tarihi</label>
                            <input type="text" id="checkin" name="checkin" placeholder="2025-07-10" required>
                        </div>
                        <div class="form-group">
                            <label for="checkout">Çıkış Tarihi</label>
                            <input type="text" id="checkout" name="checkout" placeholder="2025-07-15" required>
                        </div>
                    </div>
                    

                    <div class="form-row">
                        <div class="form-group">
                            <label for="guests">Misafir Sayısı</label>
                            <select id="guests" name="guests" required>
                                <option value="1">1 Kişi</option>
                                <option value="2" selected>2 Kişi</option>
                                <option value="3">3 Kişi</option>
                                <option value="4">4 Kişi</option>
                                <option value="5">5+ Kişi</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="roomTypeSearch">Oda Tipi</label>
                            <select id="roomTypeSearch" name="roomTypeSearch">
                                <option value="">Tümü</option>
                                <option value="standard">Standart</option>
                                <option value="deluxe">Deluxe</option>
                                <option value="suite">Suite</option>
                                <option value="family">Aile Odası</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn">
                        <span id="searchBtnText">🔍 ODALARI ARA</span>
                        <span id="searchLoader" class="loading" style="display: none;"></span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Search Results -->
        <div class="search-results" id="searchResults">
            <h2 class="panel-title">Arama Sonuçları</h2>
            <div id="roomsList"></div>
        </div>

        <!-- Room Management (Admin Only) -->
        <div class="room-management" id="roomManagement">
            <h2 class="panel-title">🏨 Oda Yönetimi</h2>
            <div class="room-list" id="roomList"></div>
        </div>

        <!-- My Bookings (User Only) -->
        <div class="my-bookings" id="myBookings">
            <h2 class="panel-title">📋 Rezervasyonlarım</h2>
            <div id="bookingsList"></div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>🔑 Kullanıcı Girişi</h2>
            <div class="error-message" id="loginError"></div>
            
            <!-- Test verisi bilgisi -->
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                <h4 style="margin: 0 0 10px 0; color: #1976d2;">💡 Test Verisi</h4>
                <p style="margin: 0; font-size: 14px; color: #555;">
                    <strong>Email:</strong> user@example.com<br>
                    <strong>Şifre:</strong> user1234
                </p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">E-posta</label>
                    <input type="email" id="loginEmail" value="user@example.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Şifre</label>
                    <input type="password" id="loginPassword" value="user1234" required>
                </div>
                <button type="submit" class="btn">
                    <span id="loginBtnText">GİRİŞ YAP</span>
                    <span id="loginBtnLoader" class="loading" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2>📝 Kayıt Ol</h2>
            <div class="error-message" id="registerError"></div>
            <div class="success-message" id="registerSuccess"></div>
            
            <!-- Test verisi bilgisi -->
            <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                <h4 style="margin: 0 0 10px 0; color: #2e7d32;">💡 Test Verisi</h4>
                <p style="margin: 0; font-size: 14px; color: #555;">
                    <strong>Email:</strong> user@example.com<br>
                    <strong>Şifre:</strong> user1234
                </p>
            </div>
            
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerEmail">E-posta</label>
                    <input type="email" id="registerEmail" value="user@example.com" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Şifre</label>
                    <input type="password" id="registerPassword" value="user1234" required>
                </div>
                <button type="submit" class="btn">
                    <span id="registerBtnText">KAYIT OL</span>
                    <span id="registerBtnLoader" class="loading" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('adminLoginModal')">&times;</span>
            <h2>🔐 Admin Girişi</h2>
            <div class="error-message" id="adminLoginError"></div>
            
            <!-- Test verisi bilgisi -->
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                <h4 style="margin: 0 0 10px 0; color: #1976d2;">💡 Test Verisi</h4>
                <p style="margin: 0; font-size: 14px; color: #555;">
                    <strong>Email:</strong> admin@example.com<br>
                    <strong>Şifre:</strong> 123456
                </p>
            </div>
            
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminEmail">Admin E-posta</label>
                    <input type="email" id="adminEmail" value="admin@example.com" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Admin Şifre</label>
                    <input type="password" id="adminPassword" value="123456" required>
                </div>
                <button type="submit" class="btn">
                    <span id="adminLoginBtnText">ADMİN GİRİŞİ</span>
                    <span id="adminLoginBtnLoader" class="loading" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bookingModal')">&times;</span>
            <h2>🏨 Rezervasyon Yap</h2>
            <div class="error-message" id="bookingError"></div>
            <div class="success-message" id="bookingSuccess"></div>
            <form id="bookingForm">
                <div id="bookingRoomInfo"></div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="bookingCheckin">Giriş Tarihi</label>
                        <input type="date" id="bookingCheckin" required>
                    </div>
                    <div class="form-group">
                        <label for="bookingCheckout">Çıkış Tarihi</label>
                        <input type="date" id="bookingCheckout" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="bookingGuests">Misafir Sayısı</label>
                    <select id="bookingGuests" required>
                        <option value="1">1 Kişi</option>
                        <option value="2">2 Kişi</option>
                        <option value="3">3 Kişi</option>
                        <option value="4">4 Kişi</option>
                        <option value="5">5+ Kişi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="specialRequests">Özel İstekler</label>
                    <textarea id="specialRequests" rows="3" placeholder="Özel isteklerinizi buraya yazabilirsiniz"></textarea>
                </div>
                <div id="totalPrice" style="font-size: 18px; font-weight: bold; margin: 15px 0; color: #667eea;"></div>
                <button type="submit" class="btn">
                    <span id="bookingBtnText">REZERVASYON YAP</span>
                    <span id="bookingBtnLoader" class="loading" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Comment Modal -->
    <div id="commentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('commentModal')">&times;</span>
            <h2>💬 Yorum Yap</h2>
            <div class="error-message" id="commentError"></div>
            <div class="success-message" id="commentSuccess"></div>
            <form id="commentForm">
                <div id="commentRoomInfo"></div>
                <div class="form-group">
                    <label for="rating">Puan (1-5)</label>
                    <select id="rating" required>
                        <option value="">Puan Seçin</option>
                        <option value="1">⭐ 1 - Çok Kötü</option>
                        <option value="2">⭐⭐ 2 - Kötü</option>
                        <option value="3">⭐⭐⭐ 3 - Orta</option>
                        <option value="4">⭐⭐⭐⭐ 4 - İyi</option>
                        <option value="5">⭐⭐⭐⭐⭐ 5 - Mükemmel</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="commentText">Yorumunuz</label>
                    <textarea id="commentText" rows="4" required placeholder="Konaklama deneyiminizi paylaşın..."></textarea>
                </div>
                <button type="submit" class="btn">
                    <span id="commentBtnText">YORUM GÖNDER</span>
                    <span id="commentBtnLoader" class="loading" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification" id="notification"></div>

    <script>
        // API Configuration
        const API_BASE_URL = 'https://hotel-booking-system-2-aay3.onrender.com/api/v1'; // Ana API
        const COMMENTS_API_URL = 'https://hotel-booking-system-2-aay3.onrender.com'; // Comment API (root seviyede)
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
        const GEMINI_API_KEY = 'AIzaSyBV7n8ZSmMa4HsCn2GVuzM8qVOWS1oZpaA'; // 🔑 Buraya kendi API anahtarını yaz

    async function askGemini(message) {
        const body = {
            contents: [
                { parts: [{ text: message }] }
            ]
        };
        try {
            const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ Bot şu anda yanıt veremiyor.";
        } catch (error) {
            console.error('Gemini API error:', error);
            return "⚠️ Bir hata oluştu.";
        }
    }

    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');
    const sendBtn = document.getElementById('chatSendBtn');

    async function sendChatMessage() {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        // Kullanıcı mesajı
        const userDiv = document.createElement('div');
        userDiv.style.marginBottom = '8px';
        userDiv.innerHTML = `<strong>👤 Siz:</strong> ${userMessage}`;
        chatMessages.appendChild(userDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        chatInput.value = '';

        // Bot bekliyor
        const loadingDiv = document.createElement('div');
        loadingDiv.style.color = '#667eea';
        loadingDiv.innerHTML = `💬 Bot yazıyor...`;
        chatMessages.appendChild(loadingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Yanıt al
        const botReply = await askGemini(userMessage);

        // Loading kaldır
        chatMessages.removeChild(loadingDiv);

        // Bot cevabı
        const botDiv = document.createElement('div');
        botDiv.style.marginBottom = '8px';
        botDiv.innerHTML = `<strong>🤖 Bot:</strong> ${botReply}`;
        chatMessages.appendChild(botDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    sendBtn.addEventListener('click', sendChatMessage);
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendChatMessage();
    });
        
        // Global state
        let currentUser = null;
        let isAdmin = false;
        let currentRoomId = null;
        let editingRoomId = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            checkAuthStatus();
            setDefaultDates();
        });

        // Initialize application
        function initializeApp() {
            // Form event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            document.getElementById('searchForm').addEventListener('submit', handleSearch);
            document.getElementById('roomForm').addEventListener('submit', handleRoomSubmit);
            document.getElementById('bookingForm').addEventListener('submit', handleBooking);
            document.getElementById('commentForm').addEventListener('submit', handleComment);

            // Modal close on outside click
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
        }

        // Check authentication status on page load
        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            const userType = localStorage.getItem('userType');
            
            if (token) {
                if (userType === 'admin') {
                    loadAdminProfile();
                } else {
                    loadUserProfile();
                }
            }
        }

        // Set default dates
        function setDefaultDates() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            const dayAfter = new Date(today);
            dayAfter.setDate(today.getDate() + 2);

            document.getElementById('checkin').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('checkout').value = dayAfter.toISOString().split('T')[0];
            document.getElementById('bookingCheckin').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('bookingCheckout').value = dayAfter.toISOString().split('T')[0];
        }

        // API Helper functions
        async function apiRequest(url, options = {}) {
            const token = localStorage.getItem('token');
            
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` })
                }
            };

            const finalOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };

            try {
                console.log('🌐 API Request:', url);
                console.log('📤 Request options:', finalOptions);
                
                const response = await fetch(url, finalOptions);
                
                console.log('📥 Response status:', response.status);
                console.log('📥 Response headers:', Object.fromEntries(response.headers.entries()));

                // Check if response is ok
                if (!response.ok) {
                    // Try to get error message from response
                    let errorMessage;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.error || `HTTP Error: ${response.status}`;
                    } catch (e) {
                        errorMessage = `HTTP Error: ${response.status} - ${response.statusText}`;
                    }
                    
                    // Handle specific errors
                    if (response.status === 500) {
                        errorMessage = 'Server hatası. Backend servisinizi kontrol edin.';
                    } else if (response.status === 404) {
                        errorMessage = 'API endpoint bulunamadı. URL kontrolü yapın.';
                    } else if (response.status === 401) {
                        errorMessage = 'Yetkilendirme hatası. Tekrar giriş yapın.';
                        logout(); // Auto logout on auth error
                    } else if (response.status === 403) {
                        errorMessage = 'Erişim reddedildi. Yetkinizi kontrol edin.';
                    }
                    
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                console.log('📥 Response data:', data);
                return data;
                
            } catch (error) {
                console.error('❌ API Request Error:', error);
                
                // Handle network errors
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Bağlantı hatası. Backend servisiniz çalışıyor mu?');
                }
                
                // Handle CORS errors
                if (error.message.includes('CORS') || error.message.includes('Access-Control')) {
                    throw new Error('CORS hatası. Backend CORS ayarlarını kontrol edin.');
                }
                
                throw error;
            }
        }

        // Authentication functions
        async function handleLogin(e) {
            e.preventDefault();
            setLoading('loginBtnLoader', 'loginBtnText', true);
            hideError('loginError');

            try {
                const formData = {
                    email: document.getElementById('loginEmail').value,
                    password: document.getElementById('loginPassword').value
                };

                const response = await apiRequest(`${API_BASE_URL}/users/login`, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });

                localStorage.setItem('token', response.token);
                localStorage.setItem('userType', 'user');
                
                await loadUserProfile();
                closeModal('loginModal');
                showNotification('✅ Başarıyla giriş yaptınız!', 'success');
                
            } catch (error) {
                showError('loginError', error.message);
            } finally {
                setLoading('loginBtnLoader', 'loginBtnText', false);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            setLoading('registerBtnLoader', 'registerBtnText', true);
            hideError('registerError');
            hideSuccess('registerSuccess');

            try {
                const formData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    email: document.getElementById('registerEmail').value,
                    phone: document.getElementById('phone').value,
                    password: document.getElementById('registerPassword').value
                };

                await apiRequest(`${API_BASE_URL}/users/register`, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });

                showSuccess('registerSuccess', 'Kayıt başarılı! Şimdi giriş yapabilirsiniz.');
                document.getElementById('registerForm').reset();
                
                setTimeout(() => {
                    closeModal('registerModal');
                    openModal('loginModal');
                }, 2000);
                
            } catch (error) {
                showError('registerError', error.message);
            } finally {
                setLoading('registerBtnLoader', 'registerBtnText', false);
            }
        }

        async function handleAdminLogin(e) {
            e.preventDefault();
            setLoading('adminLoginBtnLoader', 'adminLoginBtnText', true);
            hideError('adminLoginError');

            try {
                const email = document.getElementById('adminEmail').value.trim();
                const password = document.getElementById('adminPassword').value;
                
                console.log('🔍 Admin login attempt:', { email, passwordLength: password.length });
                console.log('🌐 API URL:', `${API_BASE_URL}/admin/login`);

                const formData = {
                    email: email,
                    password: password
                };

                console.log('📤 Sending data:', formData);

                const response = await apiRequest(`${API_BASE_URL}/admin/login`, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });

                console.log('📥 Response received:', response);

                localStorage.setItem('token', response.token);
                localStorage.setItem('userType', 'admin');
                
                await loadAdminProfile();
                closeModal('adminLoginModal');
                showNotification('✅ Admin olarak giriş yaptınız!', 'success');
                
            } catch (error) {
                console.error('❌ Admin login error:', error);
                
                // Daha detaylı hata mesajları
                let errorMessage = error.message;
                if (errorMessage.includes('pattern')) {
                    errorMessage = 'Email formatı geçersiz. admin@example.com formatında olmalı.';
                } else if (errorMessage.includes('credentials') || errorMessage.includes('Invalid')) {
                    errorMessage = 'Email veya şifre hatalı. Test verisi: admin@example.com / 123456';
                } else if (errorMessage.includes('admin not found')) {
                    errorMessage = 'Admin kullanıcı bulunamadı. Önce admin kaydı oluşturun.';
                } else if (errorMessage.includes('Network')) {
                    errorMessage = 'Bağlantı hatası. Backend servisiniz çalışıyor mu?';
                }
                
                showError('adminLoginError', errorMessage);
            } finally {
                setLoading('adminLoginBtnLoader', 'adminLoginBtnText', false);
            }
        }

        async function loadUserProfile() {
            try {
                const profile = await apiRequest(`${API_BASE_URL}/admin/profile`);
                currentUser = profile;
                isAdmin = false;
                updateUI();
                loadMyBookings();
            } catch (error) {
                console.error('Error loading user profile:', error);
                logout();
            }
        }

        async function loadAdminProfile() {
            try {
                const profile = await apiRequest(`${API_BASE_URL}/admin/profile`);
                currentUser = profile;
                isAdmin = true;
                updateUI();
                loadRooms();
                loadAvailabilityRooms();
            } catch (error) {
                console.error('Error loading admin profile:', error);
                logout();
            }
        }

        // Admin tab management
        function showAdminTab(tabName) {
            // Hide all admin tabs
            document.querySelectorAll('.admin-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Update tab buttons
            document.querySelectorAll('.admin-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).style.display = 'block';
            document.querySelector(`[onclick="showAdminTab('${tabName}')"]`).classList.add('active');
            
            // Load data if needed
            if (tabName === 'availability') {
                loadAvailabilityRooms();
            }
        }

        // Load rooms for availability dropdown
        async function loadAvailabilityRooms() {
            try {
                const rooms = await apiRequest(`${API_BASE_URL}/rooms`);
                const select = document.getElementById('availabilityRoom');
                select.innerHTML = '<option value="">Oda seçiniz...</option>';
                
                rooms.forEach(room => {
                    const option = document.createElement('option');
                    option.value = room._id;
                    option.textContent = `Oda ${room.roomNumber} - ${getRoomTypeName(room.type)}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading rooms for availability:', error);
            }
        }

        // Handle availability form submission
        async function handleAvailabilitySubmit(e) {
          e.preventDefault();
          setLoading('availabilityLoader', 'availabilityBtnText', true);

     try {
        const roomId = document.getElementById('availabilityRoom').value;
        const startDate = document.getElementById('availabilityStartDate').value;
        const endDate = document.getElementById('availabilityEndDate').value;
        const totalRoomsInput = document.getElementById('availabilityTotalRooms').value;

        if (!roomId || !startDate || !endDate || !totalRoomsInput) {
            showNotification('❌ Tüm alanları doldurmalısınız!', 'error');
            return;
        }

        const totalRooms = parseInt(totalRoomsInput);

        if (isNaN(totalRooms) || totalRooms < 0) {
            showNotification('❌ Oda sayısı geçerli bir sayı olmalı!', 'error');
            return;
        }

        const availabilityData = {
            startDate,
            endDate,
            totalRooms
        };

        const response = await apiRequest(`${API_BASE_URL}/rooms/${roomId}/availability`, {
            method: 'POST',
            body: JSON.stringify(availabilityData)
        });

        showNotification('✅ Müsaitlik bilgisi başarıyla eklendi!', 'success');
        document.getElementById('availabilityForm').reset();

    } catch (error) {
        console.error(error);
        showNotification('❌ Müsaitlik bilgisi eklenirken hata oluştu', 'error');
    } finally {
        setLoading('availabilityLoader', 'availabilityBtnText', false);
    }
}


        // Check booking and open booking modal
        async function checkAndBook(roomId) {
            if (!currentUser) {
                showNotification('❌ Rezervasyon yapmak için giriş yapmalısınız!', 'error');
                openModal('loginModal');
                return;
            }

            try {
                // Check if user already has a booking for this room
                const params = new URLSearchParams({
                    roomId: roomId
                });
                
                const checkResult = await apiRequest(`${API_BASE_URL}/bookings/check?${params}`);
                
                if (checkResult.hasBooking) {
                    showNotification('⚠️ Bu oda için zaten bir rezervasyonunuz bulunmaktadır!', 'info');
                    return;
                }
                
                // If no existing booking, open booking modal
                openBookingModal(roomId);
                
            } catch (error) {
                console.error('Error checking booking:', error);
                // If check fails, still allow booking attempt
                openBookingModal(roomId);
            }
        }

        function updateUI() {
            if (currentUser) {
                // Show user info, hide auth buttons
                document.getElementById('userInfo').classList.add('show');
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('tabButtons').style.display = 'flex';
                
                // Update user info
                document.getElementById('userName').textContent = currentUser.firstName || currentUser.email;
                document.getElementById('userRole').textContent = isAdmin ? 'Admin' : 'Kullanıcı';
                document.getElementById('userAvatar').textContent = (currentUser.firstName || currentUser.email).charAt(0).toUpperCase();
                
                // Show/hide tabs based on user type
                if (isAdmin) {
                    document.getElementById('roomsTab').style.display = 'block';
                    document.getElementById('bookingsTab').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    showTab('search');
                } else {
                    document.getElementById('roomsTab').style.display = 'none';
                    document.getElementById('bookingsTab').style.display = 'block';
                    document.getElementById('adminPanel').style.display = 'none';
                    showTab('search');
                }
            } else {
                // Show auth buttons, hide user info
                document.getElementById('userInfo').classList.remove('show');
                document.getElementById('authButtons').style.display = 'flex';
                document.getElementById('tabButtons').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userType');
            currentUser = null;
            isAdmin = false;
            updateUI();
            showNotification('👋 Başarıyla çıkış yaptınız!', 'info');
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('roomManagement').style.display = 'none';
            document.getElementById('myBookings').style.display = 'none';
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            switch(tabName) {
                case 'search':
                    document.getElementById('searchResults').style.display = 'block';
                    document.querySelector('[onclick="showTab(\'search\')"]').classList.add('active');
                    break;
                case 'rooms':
                    document.getElementById('roomManagement').style.display = 'block';
                    document.querySelector('[onclick="showTab(\'rooms\')"]').classList.add('active');
                    loadRooms();
                    break;
                case 'bookings':
                    document.getElementById('myBookings').style.display = 'block';
                    document.querySelector('[onclick="showTab(\'bookings\')"]').classList.add('active');
                    loadMyBookings();
                    break;
            }
        }

        async function handleRoomSubmit(e) {
          e.preventDefault();
             setLoading('roomLoader', 'roomBtnText', true);

         try {
            const formData = {
       roomNumber: document.getElementById('roomNumber').value,
      roomType: document.getElementById('roomType').value, // ✅ doğru alan adı
     price: parseFloat(document.getElementById('price').value),
     capacity: parseInt(document.getElementById('capacity').value),
     description: document.getElementById('description').value,
     destination: document.getElementById('destination').value, // ✅ eksikmiş
};

        if (editingRoomId) {
            await apiRequest(`${API_BASE_URL}/rooms/${editingRoomId}`, {
                method: 'PUT',
                body: JSON.stringify(formData)
            });
        } else {
            await apiRequest(`${API_BASE_URL}/rooms`, {
                method: 'POST',
                body: JSON.stringify(formData)
            });
        }

        document.getElementById('roomForm').reset();
        loadRooms();
    } catch (error) {
        showNotification('❌ ' + error.message, 'error');
    } finally {
        setLoading('roomLoader', 'roomBtnText', false);
    }
}

        async function loadRooms() {
            try {
                const rooms = await apiRequest(`${API_BASE_URL}/rooms`);
                displayRooms(rooms, 'roomList', true);
            } catch (error) {
                console.error('Error loading rooms:', error);
                showNotification('❌ Odalar yüklenirken hata oluştu', 'error');
            }
        }
        async function editRoom(roomId) {
    try {
        const rooms = await apiRequest(`${API_BASE_URL}/rooms`);
        const room = rooms.find(r => r._id === roomId);
        
        if (room) {
            editingRoomId = roomId;

            document.getElementById('roomNumber').value = room.roomNumber;
            document.getElementById('roomType').value = room.roomType; // ✅ düzeltildi
            document.getElementById('price').value = room.price;
            document.getElementById('capacity').value = room.capacity;
            document.getElementById('description').value = room.description || '';
            
            // amenities özelliği kullanılıyor mu kontrol et
            const amenitiesEl = document.getElementById('amenities');
            if (amenitiesEl) {
                amenitiesEl.value = (room.amenities || []).join(', ');
            }

            const destinationEl = document.getElementById('destination');
            if (destinationEl) {
                destinationEl.value = room.destination || '';
            }

            document.getElementById('roomBtnText').textContent = 'ODA GÜNCELLE';

            // Formu görünür alana getir
            document.getElementById('roomForm').scrollIntoView({ behavior: 'smooth' });
        }
    } catch (error) {
        showNotification('❌ Oda bilgileri yüklenemedi', 'error');
    }
}

        async function deleteRoom(roomId) {
            if (confirm('Bu odayı silmek istediğinizden emin misiniz?')) {
                try {
                    await apiRequest(`${API_BASE_URL}/rooms/${roomId}`, {
                        method: 'DELETE'
                    });
                    showNotification('✅ Oda başarıyla silindi!', 'success');
                    loadRooms();
                } catch (error) {
                    showNotification('❌ ' + error.message, 'error');
                }
            }
        }
        async function handleSearch(e) {
    e.preventDefault();
    setLoading('searchLoader', 'searchBtnText', true);

    try {
        // 🔍 Tarih doğrulama: YYYY-MM-DD
        const isValidDate = (dateStr) => /^\d{4}-\d{2}-\d{2}$/.test(dateStr);

        const checkin = document.getElementById('checkin').value.trim();
        const checkout = document.getElementById('checkout').value.trim();
        const guests = document.getElementById('guests').value.trim();
        const location = document.getElementById('location').value.trim();
        const roomType = document.getElementById('roomTypeSearch').value.trim();

        if (!isValidDate(checkin) || !isValidDate(checkout)) {
            throw new Error("❌ Lütfen tarihi 'YYYY-MM-DD' formatında girin. Örn: 2025-07-10");
        }

        const params = new URLSearchParams({
            destination: location,
            startDate: checkin,
            endDate: checkout,
            guests: guests,
        });

        if (roomType) {
            params.append("type", roomType);
        }

        const response = await apiRequest(`${API_BASE_URL}/search?${params.toString()}`);
        const rooms = response.data || response;

        console.log("Backend'den dönen odalar:", rooms);

        displayRooms(rooms, 'roomsList', false);
        document.getElementById('searchResults').style.display = 'block';
        showTab('search');

        if (!Array.isArray(rooms) || rooms.length === 0) {
            document.getElementById('roomsList').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <h3>😔 Arama kriterlerinize uygun oda bulunamadı</h3>
                    <p>Lütfen farklı tarihler veya kriterler deneyin</p>
                </div>
            `;
        } else {
            showNotification(`🔍 ${rooms.length} oda bulundu!`, 'success');
        }

    } catch (error) {
        showNotification(error.message, 'error');
    } finally {
        setLoading('searchLoader', 'searchBtnText', false);
    }
}


        function displayRooms(rooms, containerId, isAdmin = false) {
            const container = document.getElementById(containerId);
            
            if (rooms.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>📍 Henüz oda bulunmuyor</h3>
                        <p>${isAdmin ? 'Yeni oda eklemek için formu kullanın' : 'Farklı kriterler deneyin'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = rooms.map(room => `
                <div class="room-card">
                    <div class="room-header">
                        <div>
                            <h3>${room.roomNumber} - ${getRoomTypeName(room.type)}</h3>
                            <p style="color: #666; margin: 5px 0;">👥 ${room.capacity} kişi • 💰 ${room.price}₺/gece</p>
                            ${room.description ? `<p style="color: #888; font-size: 14px;">${room.description}</p>` : ''}
                        </div>
                        <div class="room-actions">
                            ${isAdmin ? `
                                <button class="btn btn-small btn-edit" onclick="editRoom('${room._id}')">✏️ Düzenle</button>
                                <button class="btn btn-small btn-delete" onclick="deleteRoom('${room._id}')">🗑️ Sil</button>
                            ` : `
                                <button class="btn btn-small" onclick="checkAndBook('${room._id}')">📅 Rezerve Et</button>
                                <button class="btn btn-small" onclick="openCommentModal('${room._id}')" style="background: linear-gradient(135deg, #ff9800, #f57c00);">💬 Yorum Yap</button>
                            `}
                        </div>
                    </div>
                    ${room.amenities && room.amenities.length > 0 ? `
                        <div class="hotel-features" style="margin-top: 10px;">
                            ${room.amenities.map(amenity => `<span class="feature-tag">${amenity}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function getRoomTypeName(type) {
            const types = {
                'standard': 'Standart',
                'deluxe': 'Deluxe',
                'suite': 'Suite',
                'family': 'Aile Odası'
            };
            return types[type] || type;
        }

        // Booking functions
        function openBookingModal(roomId) {
            if (!currentUser) {
                showNotification('❌ Rezervasyon yapmak için giriş yapmalısınız!', 'error');
                openModal('loginModal');
                return;
            }
            
            currentRoomId = roomId;
            // Get room details
            const roomCard = document.querySelector(`[onclick="openBookingModal('${roomId}')"]`).closest('.room-card');
            const roomTitle = roomCard.querySelector('h3').textContent;
            const roomPrice = roomCard.querySelector('.room-header p').textContent;
            
            document.getElementById('bookingRoomInfo').innerHTML = `
                <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h4>🏨 ${roomTitle}</h4>
                    <p>${roomPrice}</p>
                </div>
            `;
            
            updateBookingPrice();
            openModal('bookingModal');
        }

        function updateBookingPrice() {
            const checkin = new Date(document.getElementById('bookingCheckin').value);
            const checkout = new Date(document.getElementById('bookingCheckout').value);
            
            if (checkin && checkout && checkout > checkin) {
                const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
                const roomCard = document.querySelector(`[onclick="openBookingModal('${currentRoomId}')"]`).closest('.room-card');
                const priceText = roomCard.querySelector('.room-header p').textContent;
                const priceMatch = priceText.match(/(\d+)₺/);
                
                if (priceMatch) {
                    const pricePerNight = parseInt(priceMatch[1]);
                    const totalPrice = nights * pricePerNight;
                    document.getElementById('totalPrice').innerHTML = `
                        💰 Toplam: ${totalPrice}₺ (${nights} gece × ${pricePerNight}₺)
                    `;
                }
            } else {
                document.getElementById('totalPrice').innerHTML = '';
            }
        }

        // Add event listeners for booking date changes
        document.getElementById('bookingCheckin').addEventListener('change', updateBookingPrice);
        document.getElementById('bookingCheckout').addEventListener('change', updateBookingPrice);

        async function handleBooking(e) {
            e.preventDefault();
            setLoading('bookingBtnLoader', 'bookingBtnText', true);
            hideError('bookingError');
            hideSuccess('bookingSuccess');

            try {
                const bookingData = {
                    roomId: currentRoomId,
                    checkinDate: document.getElementById('bookingCheckin').value,
                    checkoutDate: document.getElementById('bookingCheckout').value,
                    guests: parseInt(document.getElementById('bookingGuests').value),
                    specialRequests: document.getElementById('specialRequests').value
                };

                await apiRequest(`${API_BASE_URL}/bookings`, {
                    method: 'POST',
                    body: JSON.stringify(bookingData)
                });

                showSuccess('bookingSuccess', '✅ Rezervasyon başarıyla oluşturuldu!');
                document.getElementById('bookingForm').reset();
                
                setTimeout(() => {
                    closeModal('bookingModal');
                    showNotification('🎉 Rezervasyonunuz onaylandı!', 'success');
                    if (!isAdmin) loadMyBookings();
                }, 2000);
                
            } catch (error) {
                showError('bookingError', error.message);
            } finally {
                setLoading('bookingBtnLoader', 'bookingBtnText', false);
            }
        }

        async function loadMyBookings() {
            try {
                const bookings = await apiRequest(`${API_BASE_URL}/bookings/my`);
                displayBookings(bookings);
            } catch (error) {
                console.error('Error loading bookings:', error);
                showNotification('❌ Rezervasyonlar yüklenirken hata oluştu', 'error');
            }
        }

        function displayBookings(bookings) {
            const container = document.getElementById('bookingsList');
            
            if (bookings.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>📋 Henüz rezervasyonunuz bulunmuyor</h3>
                        <p>Oda arayarak rezervasyon yapabilirsiniz</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = bookings.map(booking => `
                <div class="booking-card">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4>🏨 Oda ${booking.roomId?.roomNumber || 'N/A'}</h4>
                            <p><strong>📅 Giriş:</strong> ${new Date(booking.checkinDate).toLocaleDateString('tr-TR')}</p>
                            <p><strong>📅 Çıkış:</strong> ${new Date(booking.checkoutDate).toLocaleDateString('tr-TR')}</p>
                            <p><strong>👥 Misafir:</strong> ${booking.guests} kişi</p>
                            ${booking.specialRequests ? `<p><strong>📝 Özel İstekler:</strong> ${booking.specialRequests}</p>` : ''}
                        </div>
                        <div style="text-align: right;">
                            <span style="background: ${getStatusColor(booking.status)}; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                                ${getStatusText(booking.status)}
                            </span>
                            <p style="margin-top: 10px; font-weight: bold; color: #667eea;">
                                💰 ${booking.totalPrice || 'N/A'}₺
                            </p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'pending': '#ff9800',
                'confirmed': '#4caf50',
                'cancelled': '#f44336',
                'completed': '#2196f3'
            };
            return colors[status] || '#666';
        }

        function getStatusText(status) {
            const texts = {
                'pending': '⏳ Beklemede',
                'confirmed': '✅ Onaylandı',
                'cancelled': '❌ İptal',
                'completed': '🎉 Tamamlandı'
            };
            return texts[status] || status;
        }

        // Comment functions
        function openCommentModal(roomId) {
            if (!currentUser) {
                showNotification('❌ Yorum yapmak için giriş yapmalısınız!', 'error');
                openModal('loginModal');
                return;
            }
            
            currentRoomId = roomId;
            const roomCard = document.querySelector(`[onclick="openCommentModal('${roomId}')"]`).closest('.room-card');
            const roomTitle = roomCard.querySelector('h3').textContent;
            
            document.getElementById('commentRoomInfo').innerHTML = `
                <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h4>🏨 ${roomTitle}</h4>
                    <p>Bu oda hakkında deneyiminizi paylaşın</p>
                </div>
            `;
            
            openModal('commentModal');
        }

        async function handleComment(e) {
            e.preventDefault();
            setLoading('commentBtnLoader', 'commentBtnText', true);
            hideError('commentError');
            hideSuccess('commentSuccess');

            try {
                const commentData = {
                    roomId: currentRoomId,
                    rating: parseInt(document.getElementById('rating').value),
                    comment: document.getElementById('commentText').value
                };

                await apiRequest(`${COMMENTS_API_URL}/comments`, {
                    method: 'POST',
                    body: JSON.stringify(commentData)
                });

                showSuccess('commentSuccess', '✅ Yorumunuz başarıyla gönderildi!');
                document.getElementById('commentForm').reset();
                
                setTimeout(() => {
                    closeModal('commentModal');
                    showNotification('💬 Yorumunuz için teşekkürler!', 'success');
                }, 2000);
                
            } catch (error) {
                showError('commentError', error.message);
            } finally {
                setLoading('commentBtnLoader', 'commentBtnText', false);
            }
        }

        // UI Helper functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Clear form errors
            const errorElements = document.querySelectorAll(`#${modalId} .error-message, #${modalId} .success-message`);
            errorElements.forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
        }

        function setLoading(loaderId, textId, isLoading) {
            const loader = document.getElementById(loaderId);
            const text = document.getElementById(textId);
            
            if (isLoading) {
                loader.style.display = 'inline-block';
                text.style.display = 'none';
            } else {
                loader.style.display = 'none';
                text.style.display = 'inline';
            }
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideError(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideSuccess(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Initialize search on page load
        setTimeout(() => {
            if (!currentUser) {
                showNotification('👋 Hotel Swiss\'e hoş geldiniz! Giriş yaparak tüm özellikleri kullanabilirsiniz.', 'info');
            }
        }, 1000);

        console.log('🏨 Hotel Swiss - Backend entegrasyonu tamamlandı!');
        console.log('🔗 API Base URL:', API_BASE_URL);
    </script>
</body>
</html>